<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tic - Toe</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  font-family: Arial, Helvetica, sans-serif;
  color: white;
}

.game {
  background: #111;
  padding: 20px;
  border-radius: 16px;
  width: 280px;
  text-align: center;
  box-shadow: 0 20px 40px rgba(0,0,0,0.6);
}

h1 { 
  color: #00ffd5; 
  margin-bottom: 12px; 
  font-size: 1.8rem;
}

.status {
  margin-bottom: 12px;
  font-size: 1rem;
}

button {
  margin: 6px 0;
  width: 100%;
  padding: 8px;
  background: #00ffd5;
  border: none;
  border-radius: 10px;
  font-weight: bold;
  cursor: pointer;
  font-size: 0.9rem;
}

button:hover { background: #00b3ff; color: white; }
.selected { background: #ff4d4d; color: white; }

.symbol-btn { width: 48%; margin:2px; font-size:0.9rem; }
.undo-redo { width: 48%; margin:2px; font-size:0.9rem; background:#ffb347; }
.undo-redo:hover { background:#ffa500; color:black; }

/* Level selection buttons vertical */
#level-select button {
  display: block;
  width: 140px;
  margin: 6px auto;
}

/* Game board cells side by side */
.board {
  display: grid;
  grid-template-columns: repeat(3, 60px);
  grid-template-rows: repeat(3, 60px);
  gap: 6px;
  justify-content: center;
  margin: 12px auto;
}

.cell {
  width: 60px;
  height: 60px;
  background: #0f0f0f;
  border: 2px solid #444;
  border-radius: 12px;
  font-size: 1.8rem;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: background 0.2s;
}

.cell:hover { background: #1f1f1f; }

.cell.x { color: #00b3ff; }
.cell.y { color: #ff4d4d; }
.cell.winner { background: #00ffd5 !important; color: black !important; }

.hidden { display: none; }
</style>
</head>

<body>

<div class="game">
  <h1>Tic - Toe</h1>

  <!-- Step 1: Level selection -->
  <div id="level-select">
    <button onclick="chooseLevel('easy', this)">Easy</button>
    <button onclick="chooseLevel('medium', this)">Medium</button>
    <button onclick="chooseLevel('hard', this)">Hard</button>
  </div>

  <!-- Step 2: Symbol selection (hidden initially) -->
  <div id="symbol-select" class="hidden">
    <div style="margin-bottom:4px;">Choose Your Symbol:</div>
    <button class="symbol-btn" onclick="chooseSymbol('X', this)">X</button>
    <button class="symbol-btn" onclick="chooseSymbol('Y', this)">Y</button>
  </div>

  <!-- Status -->
  <div class="status" id="status">Select level to start</div>

  <!-- Game board -->
  <div class="board hidden" id="board">
    <div class="cell" data-i="0"></div>
    <div class="cell" data-i="1"></div>
    <div class="cell" data-i="2"></div>
    <div class="cell" data-i="3"></div>
    <div class="cell" data-i="4"></div>
    <div class="cell" data-i="5"></div>
    <div class="cell" data-i="6"></div>
    <div class="cell" data-i="7"></div>
    <div class="cell" data-i="8"></div>
  </div>

  <!-- Undo/Redo buttons -->
  <div id="undo-redo" class="hidden">
    <button class="undo-redo" onclick="undo()">Undo</button>
    <button class="undo-redo" onclick="redo()">Redo</button>
  </div>

  <!-- Restart button -->
  <button id="restart-btn" class="hidden" onclick="restart()">Restart</button>
</div>

<script>
const cells = document.querySelectorAll(".cell");
const statusText = document.getElementById("status");

let board = Array(9).fill("");
let gameOver = false;
let userStarts = true; // Alternates each game
let currentPlayer = "X"; 
let difficulty = null; 
let userSymbol = null;
let computerSymbol = null;

// Undo/Redo
let history = [];
let currentStep = -1;
let computerTimer = null;

const wins = [
  [0,1,2],[3,4,5],[6,7,8],
  [0,3,6],[1,4,7],[2,5,8],
  [0,4,8],[2,4,6]
];

cells.forEach(c => c.addEventListener("click", playerMove));

// --- Step 1: choose level ---
function chooseLevel(level, btn){
  difficulty = level;
  document.querySelectorAll("#level-select button").forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
  document.getElementById("level-select").classList.add("hidden");
  document.getElementById("symbol-select").classList.remove("hidden");
  statusText.textContent = `Level: ${level}. Now choose your symbol`;
}

// --- Step 2: choose symbol ---
function chooseSymbol(sym, btn){
  userSymbol = sym;
  computerSymbol = (sym === 'X') ? 'Y' : 'X';
  document.querySelectorAll('#symbol-select button').forEach(b=>b.classList.remove("selected"));
  btn.classList.add("selected");
  document.getElementById("symbol-select").classList.add("hidden");
  startGame();
}

// --- Start game ---
function startGame(){
  board.fill("");
  gameOver=false;
  cells.forEach(c=>{ c.textContent=""; c.className="cell"; });

  document.getElementById("board").classList.remove("hidden");
  document.getElementById("undo-redo").classList.remove("hidden");
  document.getElementById("restart-btn").classList.remove("hidden");

  history = [];
  currentStep = -1;
  clearTimeout(computerTimer);

  if(userStarts){
    currentPlayer = userSymbol;
    statusText.textContent = `Your Turn (${userSymbol})`;
  } else {
    currentPlayer = computerSymbol;
    statusText.textContent = `Computer Starts (${computerSymbol})`;
    computerTimer = setTimeout(computerMove,500);
  }
}

// --- Player move ---
function playerMove(e){
  const i = e.target.dataset.i;
  if(gameOver || board[i] || currentPlayer !== userSymbol) return;

  makeMove(i,userSymbol);
  if(checkEnd(userSymbol)) return;

  statusText.textContent = "Computer Thinking...";
  computerTimer = setTimeout(computerMove,400);
}

// --- Computer move ---
function computerMove(){
  if(gameOver || currentPlayer!==computerSymbol) return;

  let i;
  if(difficulty==="easy") i=randomMove();
  else if(difficulty==="medium") i=mediumMove();
  else i=minimax(board, computerSymbol).index;

  makeMove(i,computerSymbol);
  if(!checkEnd(computerSymbol)){
    statusText.textContent = `Your Turn (${userSymbol})`;
  }
}

// --- Make move ---
function makeMove(i,p){
  board[i] = p;
  cells[i].textContent = p;
  cells[i].className = "cell";
  cells[i].classList.add(p.toLowerCase());

  // Save board + next turn for true turn restoration
  const nextTurn = (p === userSymbol) ? computerSymbol : userSymbol;
  history = history.slice(0, currentStep + 1);
  history.push({ board: [...board], turn: nextTurn });
  currentStep++;
  currentPlayer = nextTurn; // update currentPlayer to next player
}

// --- Check win/draw ---
function checkEnd(player){
  for(let combo of wins){
    if(combo.every(i=>board[i]===player)){
      gameOver=true;
      statusText.textContent = player===userSymbol ? "You Win ðŸŽ‰" : "Computer Wins ðŸ¤–";
      combo.forEach(i=>cells[i].classList.add("winner"));
      setTimeout(() => resetToLevelSelect(), 2000);
      return true;
    }
  }
  if(!board.includes("")){
    gameOver=true;
    statusText.textContent="Draw ðŸ˜";
    setTimeout(() => resetToLevelSelect(), 2000);
    return true;
  }
  return false;
}

// --- Undo/Redo ---
function undo(){
  if(currentStep <= 0) return;
  currentStep--;
  const snapshot = history[currentStep];
  board = [...snapshot.board];
  currentPlayer = snapshot.turn;
  renderBoard();
  updateStatusText();
}

function redo(){
  if(currentStep >= history.length-1) return;
  currentStep++;
  const snapshot = history[currentStep];
  const prevBoard = history[currentStep-1]?.board || Array(9).fill("");
  const newBoard = snapshot.board;

  board = [...newBoard];
  currentPlayer = snapshot.turn;

  // Highlight the redo move
  const lastMoveIndex = newBoard.findIndex((v,i)=>v!==prevBoard[i]);
  if(lastMoveIndex !== -1){
    cells[lastMoveIndex].textContent = board[lastMoveIndex];
    cells[lastMoveIndex].className = "cell";
    cells[lastMoveIndex].classList.add(board[lastMoveIndex].toLowerCase());
  }

  renderBoard();
  updateStatusText();
}

// --- Update status ---
function updateStatusText(){
  if(gameOver) return;

  if(currentPlayer === userSymbol){
    statusText.textContent = `Your Turn (${userSymbol})`;
  } else {
    statusText.textContent = "Computer will move in 5 seconds...";
    clearTimeout(computerTimer);
    computerTimer = setTimeout(() => computerMove(), 5000);
  }
}

// --- Render board ---
function renderBoard(){
  cells.forEach((c,i)=>{
    c.textContent = board[i];
    c.className = "cell";
    if(board[i]) c.classList.add(board[i].toLowerCase());
  });
}

// --- Random / Medium / Hard ---
function randomMove(){
  const empty = board.map((v,i)=>v===""?i:null).filter(v=>v!==null);
  return empty[Math.floor(Math.random()*empty.length)];
}

function mediumMove(){
  const empty = board.map((v,i)=>v===""?i:null).filter(v=>v!==null);
  for(let i of empty){
    board[i]=computerSymbol;
    if(checkWinner(board,computerSymbol)){ board[i]=""; return i; }
    board[i]="";
  }
  for(let i of empty){
    board[i]=userSymbol;
    if(checkWinner(board,userSymbol)){ board[i]=""; return i; }
    board[i]="";
  }
  return randomMove();
}

function minimax(b,player){
  const empty = b.map((v,i)=>v===""?i:null).filter(v=>v!==null);
  if(checkWinner(b,userSymbol)) return {score:-10};
  if(checkWinner(b,computerSymbol)) return {score:10};
  if(empty.length===0) return {score:0};

  let moves=[];
  for(let i of empty){
    let move={index:i};
    b[i]=player;
    move.score = minimax(b, player===computerSymbol?userSymbol:computerSymbol).score;
    b[i]="";
    moves.push(move);
  }
  return player===computerSymbol ? moves.reduce((a,b)=>a.score>b.score?a:b)
                                 : moves.reduce((a,b)=>a.score<b.score?a:b);
}

function checkWinner(b,p){
  return wins.some(c=>c.every(i=>b[i]===p));
}

// --- Restart ---
function restart(){
  userStarts = !userStarts;
  startGame();
}

// --- Reset to first slide and alternate starter ---
function resetToLevelSelect(){
  document.getElementById("board").classList.add("hidden");
  document.getElementById("undo-redo").classList.add("hidden");
  document.getElementById("restart-btn").classList.add("hidden");
  document.getElementById("level-select").classList.remove("hidden");

  cells.forEach(c => { c.textContent=""; c.className="cell"; });
  statusText.textContent = "Select level to start";

  board.fill("");
  gameOver = false;
  difficulty = null;
  userSymbol = null;
  computerSymbol = null;
  history = [];
  currentStep = -1;
  clearTimeout(computerTimer);

  userStarts = !userStarts; // alternate starter
}
</script>

</body>
</html>
